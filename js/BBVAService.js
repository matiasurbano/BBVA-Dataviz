function setHeader(xhr) {
  xhr.setRequestHeader('Authorization', 'YXBwLmJidmEubWF0aWFzdXJiYW5vZGV2YXBwOjBkOGQ5NDA3YjY5MTA5ZjUwNDIwMjY1ODkxZDM1YjE2MDRjYWFmYTI=');
}


var BBVAService = {
  mx_df_ranking_zipcodes : ["11000","11529","03100","06500","03800","06600","11560","01210","06700","05120","06720","03020","11590","09020","03310","14300","07760","03810","04500","11320","07300","01900","11520","14390","07840","03330","11500","11510","14640","06140","06350","01090","15620","14000","04200","06100","01070","07700","04700","05348","04310","03300","03600","01020","06010","05110","01000","10200","03910","01180","06300","11220","14200","06470","05200","03000","14050","11870","15900","04210","06400","05500","11550","02120","11850","06760","04330","01010","09040","03900","11300","11700","15520","03650","03720","14060","11580","15700","14330","03500","02430","08400","11800","02080","04000","01710","14210","08100","03730","04100","02300","02770","09790","04920","06170","01219","06030","01600","08500","03200","09820","04530","07090","01030","14380","03400","02100","09210","07420","09830","07870","04940","09440","09100","05100","02800","01480","06800","04318","10400","04040","09220","14370","11410","03920","11200","09510","09420","06250","06850","01060","04830","03320","09060","04120","01120","16030","01780","07720","08600","09890","05000","06820","07810","04890","15390","03340","09850","03700","02230","04980","15500","05129","04360","08900","09730","09090","04650","14350","07640","03230","01160","14610","01260","09360","09500","14320","07800","03540","11400","03710","15320","01050","04870","04800","08200","07950","01460","14340","09880","04340","03510","15530","11950","16020","01770","04489","10700","09700","09310","03660","04929","01620","14220","15290","04250","15980","16050","11540","07320","07000","01130","11910","15000","07830","03630","02860","02600","03610","04020","14308","14090","14420","06880","09000","01170","11040","01040","06780","09430","09080","04370","16090","11830","14430","09800","04970","16210","07200","07780","04369","07070","04300","03940","07630","15510","06740","02130","15850","06220","04460","08610","15270","02710","02870","14110","01400","04480","09840","15820","04918","14650","16010","14630","14150","07020","02090","15410","04950","09860","07730","03440","14030","03580","07790","09099","04620","09710","04815","01500","09810","06450","03303","07850","16034","14357","07230","02960","04240","01330","02720","14310","11650","15010","10500","04730","05310","01730","09410","07450","15970","15540","07010","03530","04230","01080","03104","04600","09230","03023","07510","07600","09450","07900","03103","07280","04400","02840","15740","09070","11370","01470","08830","07620","15810","13220","02480","13200","01150","11490","01490","03240","02250","03620","07750","07708","14080","07580","03410","02810","14100","09480","01430","07920","04260","16035","04810","04220","04640","07100","08810","09300","07330","02150","11100","14250","02020","07040","09260","07380","09819","08300","11860","03560","01820","15400","01759","11430","08000","16070","03570","13360","05330","02760","04010","03820","01700","04030","11230","03520","03740","06200","10900","07270","05240","04960","11470","07820","15100","15220","07710","14010","02530","02070","01049","02440","07268","15830","07050","15210","13230","09900","03930","08930","08650","13300","09209","07860","01290","16200","02099","04610","01740","07250","07370","09400","15020","07369","08840","06430","14700","06920","01729","07290","07918","08220","16060","04470","03010","09740","09760","16740","12200","10710","08020","06270","02790","04320","07969","09930","02950","02400","11360","02350","10820","14400","04380","03220","11330","14049","09280","03550","06900","15300","10300","09270","14269","13700","16000","04930","02990","07207","09470","01110","01389","01760","14070","09837","06860","07089","07770","11270","10580","07520","05260","07650","07360","07880","14140","09780","07970","11820","02010","14500","07170","15200","09600","04630","14360","07890","02110","07570","09170","09010","01140","03640","09130","06890","10000","09720","09140","12100","11280","13000","15990","07738","15340","01580","02830","07279","13210","14646","14376","08770","10800","11250","07550","07460","09227","09828","11210","13050","07187","14600","02060","04899","09609","07480","14324","09530","02700","07740","09838","01590","02970","02160","15309","02360","09870","01250","07210","15600","09640","02310","15430","13400","05760","08010","07500","07939","08730","07889","14040","04450","08310","04739","10100","04710","01520","15240","10320","11340","02420","04410","02980","15250","14389","15640","13280","16420","02910","13219","11840","03590","04350","13420","16750","07340","11530","08620","04110","04910","02460","14209","10020","16710","14710","16600","14410","02719","02050","10640","09630","14120","11260","07440","15960","07190","01510","08510","07839","01790","15460","13040","09089","13010","16450","04660","09750","15800","09608","07910","14325","08040","10010","16739","06280","11350","14387","07960","01750","01420","09290","15730","16038","14377","02200","16300","01320","12000","05130","02169","07459","14749","13319","02040","15840","14230","14520","13250","14378","08240","14428","01530","07899","04938","08210","09670","07990","05600","07060","02630","09520","08230","02650","13080","05030","14337","06840","02240","02900","01860","11810","14388","07979","13150","13270","01220","07670","14020","01100","11930","16800","11600","01280","02940","09859","09330","02450","12400","01720","01560","10360","11440","07457","07080","14018","08700","14734","10110","14248","05520","01450","01800","04909","08910","14490","15120","11310","02320","01840","13460","02500","15750","02660","15670","10610","07400","07410","02730","09660","09940","04390","01270","07940","10600","03430","14307","09910","16040","15630","16029","04919","01830","02519","07470","02670","16036","08710","01298","09770","02127","05360","05700","09319","04737","01810","09839","03420","01408","06240","16440","01109","02410","07858","15230","09960","01650","01340","02470","15310","09690","14629","07469","09200","11420","16870","15950","11289","09160","07240","01200","02750","02490","04440","16080","15280","05530","09578","01296","05370","10340","01630","02459","05780","01789","14335","13508","09970","14326","15610","01269","09708","06870","07119","11450","13120","12700","07530","07707","09698","09240","01048","14480","09208","09460","12300","15940","09180","14620","02330","09920","14275","05410","16410","07350","08800","04319","15370","10740","13430","11480","02140","07560","14439","02729","09620","11489","13070","05270","13600","10620","11460","16810","04280","14748","14440","14160","11290","13020","13030","04939","01618","14426","16720","13100","14334","14720","02930","13450","04490","07540","05010","14270","15680","09638","13530","01410","10350","01259","13060","10830","08820","07140","02780","14608","13510","13625","07349","01540","05280","16610","08420","13310","01708","15450","14268","01640","14130","07430","01539","15870","10910","10370","14039","08920","09110","16400","15350","07680","13550","14386","05050","07310","14336","14738","07180","02340","09249","10369","01419","07110","09225","07359","07249","07130","07160","10380","02129","08760","13440","08320","01377","05020","13099","13278","16629","09219","07859","16240","10840","07058","14427","01230","13640","01610","02510","14460","02920","07458","04908","09229","01870","01089","04309","07269","02540","14740","12500","12250","09479","16797","01645","16880","02125","15420","14267","07209","15470","14429","15650","02640","10720","16430","14338","09696","01209","02680","16640","15660","09438","07188","15440","14735","14900","14739","14730","14266","13273","07980","07509","02128","13520","01566","14449","02850","16520","14239","16808","14737","16320","09550","04720","07930","07455","13419","09239"],

  getCategories: function (callback) {
    var uri = 'https://apis.bbvabancomer.com/datathon/info/merchants_categories';

    $.ajax({
      url: uri,
      type: 'GET',
      dataType: 'json',
      success: function (data) {
        if (data.result.code === 200) {
          callback(data.data.categories);
        }
       else{
          $().toasty({
              message: "There is no data for this selection.",
              autoHide: 3000
          });          
        }
      },
      error: function () {
        console.log('Error getting categories.');
        $().toasty({
            message: "There is no data for this selection.",
            autoHide: 3000
        });              
      },
      beforeSend: setHeader
    });

  },
  getFilteredZipcodes: function () {
    return this.mx_df_ranking_zipcodes;
  },
  getRankingZipcodes_offline_index : function(zipcode){
    return (this.mx_df_ranking_zipcodes.indexOf(zipcode)>1)
  },
  getRankingZipcodes: function (callback) {
    var uri = 'https://apis.bbvabancomer.com/datathon/info/zipcodes';

    $.ajax({
      url: uri,
      type: 'GET',
      dataType: 'json',
      success: function (data) {
        if (data.result.code === 200) {
          callback(data.data.zip_codes);
        }
        else{
          $().toasty({
              message: "There is no data for this selection.",
              autoHide: 3000
          });          
        }
      },
      error: function () {
        console.log('Error getting zipcode ranking.');
        
          $().toasty({
              message: "There is no data for this selection.",
              autoHide: 3000
          });          
        
      },
      beforeSend: setHeader
    });

  },
  getCustomerZipCodes: function(zipcode,category_code,min_date,max_date,order_by,callback){
    var uri = 'https://apis.bbvabancomer.com/datathon/zipcodes/_ZIPCODE_/customer_zipcodes';
    uri = uri.replace('_ZIPCODE_',zipcode);

    $.ajax({
      url: uri,
      type: 'GET',
      dataType: 'json',
      data : {
        by:'incomes',
        category:category_code,
        date_min:min_date,
        date_max:max_date,
        group_by:order_by
      },
      success: function (data) {
        if (data.result.code === 200) {
          callback(data.data.stats);
        }
        else{
          $().toasty({
              message: "There is no data for this selection.",
              autoHide: 3000
          });          
        }        
      },
      error: function () {
        console.log('Error getting cutomers by zipcode.');
          $().toasty({
              message: "There is no data for this selection.",
              autoHide: 3000
          });              
      },
      beforeSend: setHeader
    });
  },
  getGenderByZipCodes: function(zipcode,category_code,min_date,max_date,callback){
    var uri = 'https://apis.bbvabancomer.com/datathon/zipcodes/_ZIPCODE_/gender_distribution';
    uri = uri.replace('_ZIPCODE_',zipcode);

    $.ajax({
      url: uri,
      type: 'GET',
      dataType: 'json',
      data : {
        category:category_code,
        date_min:min_date,
        date_max:max_date,
        group_by:'month'
      },
      success: function (data) {
        if (data.result.code === 200) {
          callback(data.data.stats);
        }
        else{
          $().toasty({
              message: "There is no data for this selection.",
              autoHide: 3000
          });          
        }
      },
      error: function () {
        console.log('Error getting gender by zipcodes.');
      },
      beforeSend: setHeader
    });
  }

};